!function(e,t){"function"==typeof define&&define.amd?define(["jquery","MG","jstree"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("MG"),require("jstree")):e.patra=t(e.jQuery,e.MG,e.jstree)}(this,function(e,t,a){return function(e,c){"use strict";e.init=function(e){o||(o=!0,i=e,v())},e.addGraph=function(e){var t,a,r;s&&s.data.key&&(t=s.data.key,a="",r=s.data.key,s.data.type===n.COUNTER?metricsViewer.addCounter(e,t,a,r):s.data.type===n.GAUGE?metricsViewer.addGauge(e,t,a,r):s.data.type===n.METER?s.data.value?(t=t+"."+s.text,metricsViewer.addMeterWithProperty(e,t,a,r,s.text)):metricsViewer.addMeter(e,t,a,r):s.data.type===n.TIMER&&(s.data.value?(t=t+"."+s.text,metricsViewer.addTimerWithProperty(e,t,a,r,s.text)):metricsViewer.addTimer(e,t,a,r)),metricsViewer.init())};var n={COUNTER:{type:"counters"},GAUGE:{type:"gauges"},METER:{type:"meters"},TIMER:{type:"timers"}};Object.freeze(n);var t="#jstree-div";Object.freeze(t);var a="#trunk-div";Object.freeze(a);var r=".input-tree";Object.freeze(r);var i,u,s,o=!1,d=new Map,f=document.location.hash?document.location.hash.slice(1):"patra-tree";c("#trunk").load(f+".html",function(){"patra-tree"===f&&l()}),c(".docs li a#goto-"+f).addClass("active");c("ul.docs li a.viewer").on("click",function(e){e.preventDefault(),c("ul.docs li a.viewer").removeClass("active"),c(this).addClass("active"),metricsViewer.clear();var t=c(this).attr("id").slice(5);return c("#trunk").load(t+".html",function(){"patra-tree"===t&&l()}),document.location.hash=t,!1}),c(a).load("patra-viewer.html",function(){});var l=function(){d.clear(),metricsViewer.clear(),u=c(t).jstree({core:{check_callback:!0,themes:{name:"proton",responsive:!0}},ui:{},types:{key:{icon:"fa fa-folder-open-o fa-line-chart icon-blue"},value:{icon:"fa fa-line-chart icon-green"},"value-str":{icon:"fa fa-leaf icon-green"},default:{icon:"fa fa-folder icon-manila"}},plugins:["search","sort","types"]}),c(t).on("select_node.jstree",function(e,t){g(t)}),c(t).on("open_node.jstree",function(e,t){"key"!==t.node.type&&t.instance.set_icon(t.node,"fa fa-folder-open-o icon-manila")}),c(t).on("close_node.jstree",function(e,t){"key"!==t.node.type&&t.instance.set_icon(t.node,"fa fa-folder icon-manila")}),c(r).keyup(function(){var e=c(this).val();c(t).jstree("search",e)})},p=function(n,e){var i,t=e[n.type],s=n.type;d.has(s)||(h(n,"#",s,n.type,!1,!1,!1),d.set(s,"#"));var o=s;c.each(t,function(e,t){o=s;for(var a=e.split("."),r=0;r<a.length;r++)o=(i=o)+"."+a[r],d.has(o)||(r===a.length-1?h(n,i,o,a[r],!0,!1,!1):h(n,i,o,a[r],!1,!1,!1),d.set(o,i));i=o,c.each(t,function(e,t){var a;o=i+"."+e,d.has(o)||(a=c.isNumeric(t),h(n,i,o,e,!1,!0,a),d.set(o,i))})})},h=function(e,t,a,r,n,i,s){var o,c=u.jstree(!0).get_node(t),d=i?(o=s?{id:a,text:r,type:"value"}:{id:a,text:r,type:"value-str"},{type:e,key:y(e,t),value:!0}):n?(o={id:a,text:r,type:"key"},{type:e,key:y(e,a),value:!1}):{type:e,key:null,value:!(o={id:a,text:r})};u.jstree(!0).create_node(c,o),u.jstree(!0).get_node(a).data=d},y=function(e,t){var a="";for(var r in n){if(n.hasOwnProperty(r))if(e===n[r])return a=t.substring(e.type.length+1)}return a},v=function(){m(),setInterval(m,2e3)},m=function(){var e=new XMLHttpRequest;try{e.open("GET",i,!0),e.setRequestHeader("accept","application/json; charset=UTF-8"),e.withCredentials=!1,e.onload=function(){if(200==this.status&&(w(!0),this.responseText&&!k(this.responseText)))try{var e=JSON.parse(this.responseText);j(e)}catch(e){}},e.onreadystatechange=function(){if(4===this.readyState)if(200==this.status){if(w(!0),this.responseText&&!k(this.responseText))try{var e=JSON.parse(this.responseText);j(e)}catch(e){}}else w(!1)},e.send()}catch(e){w(!1)}},w=function(e){var t=c("#traffic").find("span");e?t.hasClass("icon-red")&&(t.removeClass("icon-red"),t.addClass("icon-green")):t.hasClass("icon-green")&&(t.removeClass("icon-green"),t.addClass("icon-red"))},j=function(e){metricsViewer.refresh(e),u&&function(e){for(var t in e)if(e.hasOwnProperty(t))for(var a in n){var r;!n.hasOwnProperty(a)||t===(r=n[a]).type&&p(r,e)}}(e)},g=function(e){s=e.node,metricsViewer.clear(),c(a).load("patra-viewer.html",function(){})},k=function(e){return!e||0===e.length}}(window.patra=window.patra||{},jQuery),patra});