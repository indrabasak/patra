!function(e,t){"function"==typeof define&&define.amd?define(["jquery","MG","jstree"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("MG"),require("jstree")):e.patra=t(e.jQuery,e.MG,e.jstree)}(this,function(e,t,n){return function(e,t){"use strict";e.init=function(e){l||(l=!0,s=e,g())},e.addGraph=function(e){if(c&&c.data.key){var t=c.data.key,r="",a=c.data.key;c.data.type===n.COUNTER?metricsViewer.addCounter(e,t,r,a):c.data.type===n.GAUGE?metricsViewer.addGauge(e,t,r,a):c.data.type===n.METER?c.data.value?(t=t+"."+c.text,metricsViewer.addMeterWithProperty(e,t,r,a,c.text)):metricsViewer.addMeter(e,t,r,a):c.data.type===n.TIMER&&(c.data.value?(t=t+"."+c.text,metricsViewer.addTimerWithProperty(e,t,r,a,c.text)):metricsViewer.addTimer(e,t,r,a)),metricsViewer.init()}};var n={COUNTER:{type:"counters"},GAUGE:{type:"gauges"},METER:{type:"meters"},TIMER:{type:"timers"}};Object.freeze(n);var r="#jstree-div";Object.freeze(r);var a="#trunk-div";Object.freeze(a);var i=".input-tree";Object.freeze(i);var s,o,c,l=!1,d=new Map,u=document.location.hash?document.location.hash.slice(1):"patra-tree";t("#trunk").load(u+".html",function(){"patra-tree"===u&&f()}),t(".docs li a#goto-"+u).addClass("active");var p=function(){t("ul.docs li a.viewer").on("click",function(e){e.preventDefault(),t("ul.docs li a.viewer").removeClass("active"),t(this).addClass("active"),metricsViewer.clear();var n=t(this).attr("id").slice(5);return t("#trunk").load(n+".html",function(){"patra-tree"===n&&f()}),document.location.hash=n,!1})};p(),t(a).load("patra-viewer.html",function(){});var f=function(){d.clear(),metricsViewer.clear(),o=t(r).jstree({core:{check_callback:!0,themes:{name:"proton",responsive:!0}},ui:{},types:{key:{icon:"fa fa-folder-open fa-line-chart icon-blue"},value:{icon:"fa fa-line-chart icon-green"},"value-str":{icon:"glyphicon glyphicon-leaf icon-green"},default:{icon:"glyphicon glyphicon-folder-close icon-manila"}},plugins:["search","sort","types"]}),t(r).on("select_node.jstree",function(e,t){k(t)}),t(r).on("open_node.jstree",function(e,t){"key"!==t.node.type&&t.instance.set_icon(t.node,"glyphicon glyphicon-folder-open icon-manila")}),t(r).on("close_node.jstree",function(e,t){"key"!==t.node.type&&t.instance.set_icon(t.node,"glyphicon glyphicon-folder-close icon-manila")}),t(i).keyup(function(){var e=t(this).val();t(r).jstree("search",e)})},h=function(e){for(var t in e)if(e.hasOwnProperty(t))for(var r in n)if(n.hasOwnProperty(r)){var a=n[r];t===a.type&&y(a,e)}},y=function(e,n){var r=n[e.type],a=e.type;d.has(a)||(v(e,"#",a,e.type,!1,!1,!1),d.set(a,"#"));var i,s=a;t.each(r,function(n,r){s=a;for(var o=n.split("."),c=0;c<o.length;c++)i=s,s=s+"."+o[c],d.has(s)||(c===o.length-1?v(e,i,s,o[c],!0,!1,!1):v(e,i,s,o[c],!1,!1,!1),d.set(s,i));i=s,t.each(r,function(n,r){if(s=i+"."+n,!d.has(s)){var a=t.isNumeric(r);v(e,i,s,n,!1,!0,a),d.set(s,i)}})})},v=function(e,t,n,r,a,i,s){var c,l,d=o.jstree(!0).get_node(t);i?(c=s?{id:n,text:r,type:"value"}:{id:n,text:r,type:"value-str"},l={type:e,key:m(e,t),value:!0}):a?(c={id:n,text:r,type:"key"},l={type:e,key:m(e,n),value:!1}):(c={id:n,text:r},l={type:e,key:null,value:!1}),o.jstree(!0).create_node(d,c);var u=o.jstree(!0).get_node(n);u.data=l},m=function(e,t){var r="";return e===n.COUNTER?r=t.substring(e.type.length+1):e===n.GAUGE?r=t.substring(e.type.length+1):e===n.METER?r=t.substring(e.type.length+1):e===n.TIMER&&(r=t.substring(e.type.length+1)),r},g=function(){w(),setInterval(w,2e3)},w=function(){var e=s,t=new XMLHttpRequest;try{t.open("GET",e,!0),t.setRequestHeader("accept","application/json; charset=UTF-8"),t.withCredentials=!1,t.onload=function(){if(200==this.status&&(j(!0),this.responseText&&!x(this.responseText)))try{var e=JSON.parse(this.responseText);T(e)}catch(e){}},t.onreadystatechange=function(){if(4===this.readyState)if(200==this.status){if(j(!0),this.responseText&&!x(this.responseText))try{var e=JSON.parse(this.responseText);T(e)}catch(e){}}else j(!1)},t.send()}catch(e){j(!1)}},j=function(e){var n=t("#traffic").find("span");e?n.hasClass("icon-red")&&(n.removeClass("icon-red"),n.addClass("icon-green")):n.hasClass("icon-green")&&(n.removeClass("icon-green"),n.addClass("icon-red"))},T=function(e){metricsViewer.refresh(e),o&&h(e)},k=function(e){c=e.node,metricsViewer.clear(),t(a).load("patra-viewer.html",function(){})},x=function(e){return!e||0===e.length}}(window.patra=window.patra||{},jQuery),patra});