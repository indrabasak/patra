!function(e,t){"function"==typeof define&&define.amd?define(["jquery","MG","jstree"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("MG"),require("jstree")):e.patra=t(e.jQuery,e.MG,e.jstree)}(this,function(e,t,n){return function(e,t){"use strict";e.init=function(e){l||(l=!0,s=e,g())},e.addGraph=function(e){if(c&&c.data.key){var t=c.data.key,r="",i=c.data.key;c.data.type===n.COUNTER?metricsViewer.addCounter(e,t,r,i):c.data.type===n.GAUGE?metricsViewer.addGauge(e,t,r,i):c.data.type===n.METER?c.data.value?(t=t+"."+c.text,metricsViewer.addMeterWithProperty(e,t,r,i,c.text)):metricsViewer.addMeter(e,t,r,i):c.data.type===n.TIMER&&(c.data.value?(t=t+"."+c.text,metricsViewer.addTimerWithProperty(e,t,r,i,c.text)):metricsViewer.addTimer(e,t,r,i)),metricsViewer.init()}};var n={COUNTER:{type:"counters"},GAUGE:{type:"gauges"},METER:{type:"meters"},TIMER:{type:"timers"}};Object.freeze(n);var r="#jstree-div";Object.freeze(r);var i="#trunk-div";Object.freeze(i);var a=".input-tree";Object.freeze(a);var s,o,c,l=!1,d=new Map,u=document.location.hash?document.location.hash.slice(1):"patra-tree";t("#trunk").load(u+".html",function(){"patra-tree"===u&&h()}),t(".docs li a#goto-"+u).addClass("active");var p=function(){t("ul.docs li a.viewer").on("click",function(e){e.preventDefault(),t("ul.docs li a.viewer").removeClass("active"),t(this).addClass("active"),metricsViewer.clear();var n=t(this).attr("id").slice(5);return t("#trunk").load(n+".html",function(){"patra-tree"===n&&h()}),document.location.hash=n,!1})};p(),t(i).load("patra-viewer.html",function(){});var h=function(){d.clear(),metricsViewer.clear(),o=t(r).jstree({core:{check_callback:!0,themes:{name:"proton",responsive:!0}},ui:{},types:{key:{icon:"glyphicon glyphicon-stats icon-blue"},value:{icon:"glyphicon glyphicon-stats icon-green"},"value-str":{icon:"glyphicon glyphicon-leaf icon-green"},default:{icon:"glyphicon glyphicon-folder-close icon-manila"}},plugins:["search","sort","types"]}),t(r).on("select_node.jstree",function(e,t){T(t)}),t(r).on("open_node.jstree",function(e,t){"key"!==t.node.type&&t.instance.set_icon(t.node,"glyphicon glyphicon-folder-open icon-manila")}),t(r).on("close_node.jstree",function(e,t){"key"!==t.node.type&&t.instance.set_icon(t.node,"glyphicon glyphicon-folder-close icon-manila")}),t(a).keyup(function(){var e=t(this).val();t(r).jstree("search",e)})},y=function(e,n){var r=n[e.type],i=e.type;d.has(i)||(f(e,"#",i,e.type,!1,!1,!1),d.set(i,"#"));var a,s=i;t.each(r,function(n,r){s=i;for(var o=n.split("."),c=0;c<o.length;c++)a=s,s=s+"."+o[c],d.has(s)||(c===o.length-1?f(e,a,s,o[c],!0,!1,!1):f(e,a,s,o[c],!1,!1,!1),d.set(s,a));a=s,t.each(r,function(n,r){if(s=a+"."+n,!d.has(s)){var i=t.isNumeric(r);f(e,a,s,n,!1,!0,i),d.set(s,a)}})})},f=function(e,t,n,r,i,a,s){var c,l,d=o.jstree(!0).get_node(t);a?(c=s?{id:n,text:r,type:"value"}:{id:n,text:r,type:"value-str"},l={type:e,key:v(e,t),value:!0}):i?(c={id:n,text:r,type:"key"},l={type:e,key:v(e,n),value:!1}):(c={id:n,text:r},l={type:e,key:null,value:!1}),o.jstree(!0).create_node(d,c);var u=o.jstree(!0).get_node(n);u.data=l},v=function(e,t){var r="";return e===n.COUNTER?r=t.substring(e.type.length+1):e===n.GAUGE?r=t.substring(e.type.length+1):e===n.METER?r=t.substring(e.type.length+1):e===n.TIMER&&(r=t.substring(e.type.length+1)),r},g=function(){m(),setInterval(m,2e3)},m=function(){var e=s,t=new XMLHttpRequest;try{t.open("GET",e,!0),t.setRequestHeader("accept","application/json; charset=UTF-8"),t.withCredentials=!1,t.onload=function(){if(200==this.status&&(j(!0),this.responseText&&!E(this.responseText)))try{var e=JSON.parse(this.responseText);w(e)}catch(e){}},t.onreadystatechange=function(){if(4===this.readyState)if(200==this.status){if(j(!0),this.responseText&&!E(this.responseText))try{var e=JSON.parse(this.responseText);w(e)}catch(e){}}else j(!1)},t.send()}catch(e){j(!1)}},j=function(e){var n=t("#traffic").find("span");e?n.hasClass("icon-red")&&(n.removeClass("icon-red"),n.addClass("icon-green")):n.hasClass("icon-green")&&(n.removeClass("icon-green"),n.addClass("icon-red"))},w=function(e){metricsViewer.refresh(e),o&&(y(n.COUNTER,e),y(n.GAUGE,e),y(n.METER,e),y(n.TIMER,e))},T=function(e){c=e.node,metricsViewer.clear(),t(i).load("patra-viewer.html",function(){})},E=function(e){return!e||0===e.length}}(window.patra=window.patra||{},jQuery),patra});