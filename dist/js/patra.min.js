!function(e,t){"function"==typeof define&&define.amd?define(["jquery","MG","jstree"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("MG"),require("jstree")):e.patra=t(e.jQuery,e.MG,e.jstree)}(this,function(e,t,r){return function(e,t){"use strict";e.init=function(e){l||(l=!0,o=e,g())},e.addGraph=function(e){if(c&&c.data.key){var t=c.data.key,n="",a=c.data.key;c.data.type===r.COUNTER?metricsViewer.addCounter(e,t,n,a):c.data.type===r.GAUGE?metricsViewer.addGauge(e,t,n,a):c.data.type===r.METER?c.data.value?(t=t+"."+c.text,metricsViewer.addMeterWithProperty(e,t,n,a,c.text)):metricsViewer.addMeter(e,t,n,a):c.data.type===r.TIMER&&(c.data.value?(t=t+"."+c.text,metricsViewer.addTimerWithProperty(e,t,n,a,c.text)):metricsViewer.addTimer(e,t,n,a)),metricsViewer.init()}};var r={COUNTER:{type:"counters"},GAUGE:{type:"gauges"},METER:{type:"meters"},TIMER:{type:"timers"}};Object.freeze(r);var n="#jstree-div";Object.freeze(n);var a="#trunk-div";Object.freeze(a);var i=".input-tree";Object.freeze(i);var o,s,c,l=!1,d=new Map,u=document.location.hash?document.location.hash.slice(1):"patra-tree";t("#trunk").load(u+".html",function(){"patra-tree"===u&&f()}),t(".docs li a#goto-"+u).addClass("active");var p=function(){t("ul.docs li a.viewer").on("click",function(e){e.preventDefault(),t("ul.docs li a.viewer").removeClass("active"),t(this).addClass("active"),metricsViewer.clear();var r=t(this).attr("id").slice(5);return t("#trunk").load(r+".html",function(){"patra-tree"===r&&f()}),document.location.hash=r,!1})};p(),t(a).load("patra-viewer.html",function(){});var f=function(){d.clear(),metricsViewer.clear(),s=t(n).jstree({core:{check_callback:!0,themes:{name:"proton",responsive:!0}},ui:{},types:{key:{icon:"fa fa-folder-open fa-line-chart icon-blue"},value:{icon:"fa fa-line-chart icon-green"},"value-str":{icon:"glyphicon glyphicon-leaf icon-green"},default:{icon:"glyphicon glyphicon-folder-close icon-manila"}},plugins:["search","sort","types"]}),t(n).on("select_node.jstree",function(e,t){x(t)}),t(n).on("open_node.jstree",function(e,t){"key"!==t.node.type&&t.instance.set_icon(t.node,"glyphicon glyphicon-folder-open icon-manila")}),t(n).on("close_node.jstree",function(e,t){"key"!==t.node.type&&t.instance.set_icon(t.node,"glyphicon glyphicon-folder-close icon-manila")}),t(i).keyup(function(){var e=t(this).val();t(n).jstree("search",e)})},h=function(e){for(var t in e)if(e.hasOwnProperty(t))for(var n in r)if(r.hasOwnProperty(n)){var a=r[n];t===a.type&&y(a,e)}},y=function(e,r){var n=r[e.type],a=e.type;d.has(a)||(v(e,"#",a,e.type,!1,!1,!1),d.set(a,"#"));var i,o=a;t.each(n,function(r,n){o=a;for(var s=r.split("."),c=0;c<s.length;c++)i=o,o=o+"."+s[c],d.has(o)||(c===s.length-1?v(e,i,o,s[c],!0,!1,!1):v(e,i,o,s[c],!1,!1,!1),d.set(o,i));i=o,t.each(n,function(r,n){if(o=i+"."+r,!d.has(o)){var a=t.isNumeric(n);v(e,i,o,r,!1,!0,a),d.set(o,i)}})})},v=function(e,t,r,n,a,i,o){var c,l,d=s.jstree(!0).get_node(t);i?(c=o?{id:r,text:n,type:"value"}:{id:r,text:n,type:"value-str"},l={type:e,key:m(e,t),value:!0}):a?(c={id:r,text:n,type:"key"},l={type:e,key:m(e,r),value:!1}):(c={id:r,text:n},l={type:e,key:null,value:!1}),s.jstree(!0).create_node(d,c);var u=s.jstree(!0).get_node(r);u.data=l},m=function(e,t){var n="";for(var a in r)if(r.hasOwnProperty(a)){var i=r[a];if(e===i)return n=t.substring(e.type.length+1)}return n},g=function(){w(),setInterval(w,2e3)},w=function(){var e=new XMLHttpRequest;try{e.open("GET",o,!0),e.setRequestHeader("accept","application/json; charset=UTF-8"),e.withCredentials=!1,e.onload=function(){if(200==this.status&&(j(!0),this.responseText&&!T(this.responseText)))try{var e=JSON.parse(this.responseText);k(e)}catch(e){}},e.onreadystatechange=function(){if(4===this.readyState)if(200==this.status){if(j(!0),this.responseText&&!T(this.responseText))try{var e=JSON.parse(this.responseText);k(e)}catch(e){}}else j(!1)},e.send()}catch(e){j(!1)}},j=function(e){var r=t("#traffic").find("span");e?r.hasClass("icon-red")&&(r.removeClass("icon-red"),r.addClass("icon-green")):r.hasClass("icon-green")&&(r.removeClass("icon-green"),r.addClass("icon-red"))},k=function(e){metricsViewer.refresh(e),s&&h(e)},x=function(e){c=e.node,metricsViewer.clear(),t(a).load("patra-viewer.html",function(){})},T=function(e){return!e||0===e.length}}(window.patra=window.patra||{},jQuery),patra});