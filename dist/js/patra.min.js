!function(e,t){"function"==typeof define&&define.amd?define(["jquery","MG","jstree"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("MG"),require("jstree")):e.patra=t(e.jQuery,e.MG,e.jstree)}(this,function(e,t,r){return function(e,t){"use strict";e.init=function(e){s=e,v()},e.addGraph=function(e){if(o&&o.data.key){var t=o.data.key,a="",i=o.data.key;o.data.type===r.COUNTER?metricsViewer.addCounter(e,t,a,i):o.data.type===r.GAUGE?metricsViewer.addGauge(e,t,a,i):o.data.type===r.METER?o.data.value?(t=t+"."+o.text,metricsViewer.addMeterWithProperty(e,t,a,i,o.text)):metricsViewer.addMeter(e,t,a,i):o.data.type===r.TIMER&&(o.data.value?(t=t+"."+o.text,metricsViewer.addTimerWithProperty(e,t,a,i,o.text)):metricsViewer.addTimer(e,t,a,i)),metricsViewer.init()}};var r={COUNTER:{type:"counters"},GAUGE:{type:"gauges"},METER:{type:"meters"},TIMER:{type:"timers"}};Object.freeze(r);var a="#jstree-div";Object.freeze(a);var i="#trunk-div";Object.freeze(i);var n=".input-tree";Object.freeze(n);var s,c,o,u=new Map,l=document.location.hash?document.location.hash.slice(1):"patra-tree";t("#trunk").load(l+".html",function(){"patra-tree"===l&&d()}),t(".docs li a#goto-"+l).addClass("active");var p=function(){t("ul.docs li a.viewer").on("click",function(e){e.preventDefault(),t("ul.docs li a.viewer").removeClass("active"),t(this).addClass("active"),metricsViewer.clear();var r=t(this).attr("id").slice(5);return t("#trunk").load(r+".html",function(){"patra-tree"===r&&d()}),document.location.hash=r,!1})};p(),t(i).load("patra-viewer.html",function(){});var d=function(){u.clear(),metricsViewer.clear(),c=t(a).jstree({core:{check_callback:!0},themes:{},ui:{},types:{key:{icon:"glyphicon glyphicon-stats icon-blue"},value:{icon:"glyphicon glyphicon-stats icon-green"},"value-str":{icon:"glyphicon glyphicon-leaf icon-green"},default:{}},plugins:["search","sort","wholerow","types"]}),t(a).on("select_node.jstree",function(e,t){w(t)}),t(n).keyup(function(){var e=t(this).val();t(a).jstree("search",e)})},h=function(e,r){var a=r[e.type],i=e.type;u.has(i)||(y(e,"#",i,e.type,!1,!1,!1),u.set(i,"#"));var n,s=i;t.each(a,function(r,a){s=i;for(var c=r.split("."),o=0;o<c.length;o++)n=s,s=s+"."+c[o],u.has(s)||(o===c.length-1?y(e,n,s,c[o],!0,!1,!1):y(e,n,s,c[o],!1,!1,!1),u.set(s,n));n=s,t.each(a,function(r,a){if(s=n+"."+r,!u.has(s)){var i=t.isNumeric(a);y(e,n,s,r,!1,!0,i),u.set(s,n)}})})},y=function(e,t,r,a,i,n,s){var o,u,l=c.jstree(!0).get_node(t);n?(o=s?{id:r,text:a,type:"value"}:{id:r,text:a,type:"value-str"},u={type:e,key:f(e,t),value:!0}):i?(o={id:r,text:a,type:"key"},u={type:e,key:f(e,r),value:!1}):(o={id:r,text:a},u={type:e,key:null,value:!1}),c.jstree(!0).create_node(l,o);var p=c.jstree(!0).get_node(r);p.data=u},f=function(e,t){var a="";return e===r.COUNTER?a=t.substring(e.type.length+1):e===r.GAUGE?a=t.substring(e.type.length+1):e===r.METER?a=t.substring(e.type.length+1):e===r.TIMER&&(a=t.substring(e.type.length+1)),a},v=function(){g(),setInterval(g,2e3)},g=function(){var e=s,t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("accept","application/json; charset=UTF-8"),t.withCredentials=!1,t.onload=function(){if(200==this.status&&this.responseText&&!T(this.responseText))try{var e=JSON.parse(this.responseText);m(e)}catch(e){}},t.onreadystatechange=function(){if(200==this.status&&this.responseText&&!T(this.responseText))try{var e=JSON.parse(this.responseText);m(e)}catch(e){}},t.send()},m=function(e){metricsViewer.refresh(e),c&&(h(r.COUNTER,e),h(r.GAUGE,e),h(r.METER,e),h(r.TIMER,e))},w=function(e){o=e.node,metricsViewer.clear(),t(i).load("patra-viewer.html",function(){})},T=function(e){return!e||0===e.length}}(window.patra=window.patra||{},jQuery),patra});